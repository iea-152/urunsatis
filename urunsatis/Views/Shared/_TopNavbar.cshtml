@using System.Security.Claims
@using Microsoft.AspNetCore.Http
@using urunsatis.Extensions
@using urunsatis.Models
@inject IHttpContextAccessor HttpContextAccessor

<style>
    /* 1. Navbar Arka Planı (Koyu Gri) */
    .navbar-custom {
        background-color: #484848 !important;
        border-bottom: 1px solid #3a3a3a;
        min-height: 60px;
    }

        /* 2. Link Yazıları (Beyaz) */
        .navbar-custom .nav-link {
            color: #fff !important;
            font-size: 14px;
            font-weight: 600;
            text-transform: uppercase; /* Büyük harf */
            letter-spacing: 0.5px;
            padding: 0 1rem;
            transition: color 0.3s ease;
            display: flex;
            align-items: center;
            height: 60px; /* Navbar boyuyla eşitle */
        }

            /* 3. Mouse Üzerine Gelince (Sarı) */
            .navbar-custom .nav-link:hover {
                color: #fbc531 !important;
            }

    /* 4. Sepet Badge (Sayı) */
    .badge-warning-custom {
        background-color: #fbc531;
        color: #484848;
        font-weight: bold;
        position: absolute;
        top: 10px;
        right: 5px;
        font-size: 0.6rem;
        border-radius: 50%;
    }
</style>

<nav class="main-header navbar navbar-expand navbar-custom sticky-top">

    <ul class="navbar-nav align-items-center">
        <li class="nav-item">
            <a class="nav-link" data-widget="pushmenu" href="#" role="button">
                <i class="fas fa-bars" style="font-size: 1.2rem;"></i>
            </a>
        </li>

        <li class="nav-item d-none d-sm-inline-block">
            <a href="/Home/Index" class="nav-link">
                <i class="fas fa-home mr-1"></i> Anasayfa
            </a>
        </li>

        @await Component.InvokeAsync("CategoryMenu")
    </ul>

    <ul class="navbar-nav ml-auto align-items-center">

        @if (User.IsInRole("Admin"))
        {
            <li class="nav-item d-none d-sm-inline-block">
                <a asp-controller="Admin" asp-action="Index" class="nav-link" style="color: #fbc531 !important;">
                    <i class="fas fa-cogs mr-1"></i> Yönetim
                </a>
            </li>
        }

        @{
            var sessionCart = HttpContextAccessor.HttpContext.Session.GetObject<List<CartItem>>("Sepet");
            int cartCount = sessionCart != null ? sessionCart.Sum(x => x.Quantity) : 0;
        }
        <li class="nav-item dropdown mr-2">
            <a class="nav-link position-relative" asp-controller="Cart" asp-action="Index">
                <i class="fas fa-shopping-cart fa-lg"></i>
                @if (cartCount > 0)
                {
                    <span class="badge badge-warning-custom shadow-sm">@cartCount</span>
                }
            </a>
        </li>

        @if (User.Identity.IsAuthenticated)
        {
            <li class="nav-item dropdown user-menu">
                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">
                    <img src="/assets/img/avatar5.png" class="user-image img-circle elevation-2" alt="User Image" style="width:30px; margin-top:-2px;">
                    <span class="d-none d-md-inline ml-2">@User.FindFirst(ClaimTypes.Name)?.Value</span>
                </a>

                <ul class="dropdown-menu dropdown-menu-lg dropdown-menu-right border-0 shadow-lg">
                    <li class="user-header bg-dark">
                        <img src="/assets/img/avatar5.png" class="img-circle elevation-2" alt="User Image">
                        <p class="text-white">
                            @User.FindFirst(ClaimTypes.Name)?.Value
                            <small>Üye</small>
                        </p>
                    </li>
                    <li class="user-footer">
                        <a href="#" class="btn btn-default btn-flat">Profil</a>
                        <a asp-controller="Login" asp-action="Logout" class="btn btn-default btn-flat float-right">Çıkış</a>
                    </li>
                </ul>
            </li>
        }
        else
        {
            <li class="nav-item">
                <a asp-controller="Login" asp-action="Index" class="nav-link">
                    <i class="fas fa-sign-in-alt mr-1"></i> Oturum Aç
                </a>
            </li>
            <li class="nav-item d-none d-sm-inline-block">
                <a asp-controller="Login" asp-action="Register" class="nav-link" style="border: 1px solid #fff; border-radius: 20px; height: 35px; margin-top: 12px; line-height: 33px; padding: 0 15px;">
                    Kayıt Ol
                </a>
            </li>
        }
    </ul>
</nav>